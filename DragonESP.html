<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon ESP</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* CSS Variables for Theming */
        :root {
            --primary-color: #00A9FF;
            --secondary-color: #3876BF;
            --background-color: #191919;
            --surface-color: #2C2C2C;
            --text-color: #E0E0E0;
            --text-muted-color: #A0A0E0;
            --accent-green: #28a745;
            --accent-red: #dc3545;
            --accent-yellow: #ffc107;
            --font-family: 'Poppins', sans-serif;
            --border-color: #444;
            --input-bg-color: #333;
            --input-border-color: #555;
            --progress-bg-color: #444;
            --card-details-bg: rgba(0,0,0,0.3);
            --countdown-bg: rgba(0,0,0,0.4);
            --list-item-bg: #3a3a3a;
        }

        body.light-theme {
            --primary-color: #007BFF;
            --secondary-color: #0056b3;
            --background-color: #F0F2F5;
            --surface-color: #FFFFFF;
            --text-color: #1c1e21;
            --text-muted-color: #6c757d;
            --border-color: #DDDFE2;
            --input-bg-color: #E9ECEF;
            --input-border-color: #CED4DA;
            --progress-bg-color: #E9ECEF;
            --card-details-bg: rgba(0, 0, 0, 0.05);
            --countdown-bg: rgba(0, 0, 0, 0.05);
            --list-item-bg: #f8f9fa;
        }

        /* General Reset and Body Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            overscroll-behavior: none;
            transition: background-color 0.3s, color 0.3s;
        }
        .hidden { display: none !important; }

        /* === Authentication Page Styles === */
        #auth-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d); }
        .auth-wrapper { position: relative; width: 400px; height: 440px; background: transparent; border: 2px solid rgba(255, 255, 255, 0.5); border-radius: 20px; backdrop-filter: blur(15px); display: flex; justify-content: center; align-items: center; overflow: hidden; transition: height .2s ease; }
        .auth-wrapper.active { height: 520px; }
        .auth-wrapper .form-box { width: 100%; padding: 40px; }
        .auth-wrapper .form-box.login { transition: transform .18s ease; transform: translateX(0); }
        .auth-wrapper.active .form-box.login { transition: none; transform: translateX(-400px); }
        .auth-wrapper .form-box.register { position: absolute; transition: none; transform: translateX(400px); }
        .auth-wrapper.active .form-box.register { transition: transform .18s ease; transform: translateX(0); }
        .form-box h2 { font-size: 2em; color: #fff; text-align: center; }
        .input-box { position: relative; width: 100%; height: 50px; border-bottom: 2px solid #fff; margin: 30px 0; }
        .input-box label { position: absolute; top: 50%; left: 5px; transform: translateY(-50%); font-size: 1em; color: #fff; font-weight: 500; pointer-events: none; transition: .5s; }
        .input-box input:focus~label, .input-box input:valid~label { top: -5px; }
        .input-box input { width: 100%; height: 100%; background: transparent; border: none; outline: none; font-size: 1em; color: #fff; font-weight: 600; padding: 0 35px 0 5px; }
        .input-box .icon { position: absolute; right: 8px; font-size: 1.2em; color: #fff; line-height: 57px; }
        .auth-btn { width: 100%; height: 45px; background: #fff; border: none; outline: none; border-radius: 6px; cursor: pointer; font-size: 1em; color: #000; font-weight: 500; }
        .login-register { font-size: .9em; color: #fff; text-align: center; font-weight: 500; margin: 25px 0 10px; }
        .login-register p a { color: #fff; text-decoration: none; font-weight: 600; }
        .login-register p a:hover { text-decoration: underline; }
        .auth-error { color: #ffb3b3; background-color: rgba(220, 53, 69, 0.3); border: 1px solid var(--accent-red); padding: 8px; border-radius: 4px; font-size: 0.9em; text-align: center; margin-top: 10px; }

        /* === Main App Styles === */
        #app-container { display: flex; flex-direction: column; height: 100vh; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px; background-color: var(--surface-color); border-bottom: 1px solid var(--border-color); }
        .logo { font-weight: 700; font-size: 1.5rem; color: var(--primary-color); }
        .logo img { height: 25px; vertical-align: middle; margin-right: 5px;}
        .wallet-balance { background-color: rgba(0, 169, 255, 0.1); padding: 8px 15px; border-radius: 20px; font-weight: 600; border: 1px solid var(--primary-color); }
        main { flex-grow: 1; overflow-y: auto; padding: 15px 15px 80px 15px; }
        main section { animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        nav { position: fixed; bottom: 0; left: 0; right: 0; display: flex; justify-content: space-around; background-color: var(--surface-color); border-top: 1px solid var(--border-color); padding: 10px 0; }
        nav a { color: var(--text-muted-color); text-decoration: none; text-align: center; font-size: 0.75rem; display: flex; flex-direction: column; align-items: center; gap: 4px; transition: color 0.3s; }
        nav a i { font-size: 1.5rem; }
        nav a.active { color: var(--primary-color); }
        
        /* === Slider Styles (New) === */
        .slider {
            position: relative;
            width: 100%;
            height: 180px;
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden;
            background-color: var(--surface-color);
        }
        .slider-images .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }
        .slider-images .slide.active {
            opacity: 1;
        }
        .slider-images .slide a {
            display: block;
            width: 100%;
            height: 100%;
        }
        .slider-images img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .slider-dots {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }
        .slider-dots .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .slider-dots .dot.active {
            background-color: white;
        }

        .card { background-color: var(--surface-color); border-radius: 12px; padding: 15px; margin-bottom: 15px; border-left: 5px solid var(--primary-color); }
        .btn { display: inline-block; padding: 10px 20px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; text-align: center; font-family: var(--font-family); font-size: 1rem; }
        .btn:disabled { background-color: #555 !important; color: #999 !important; cursor: not-allowed !important; }
        .btn-primary { background-color: var(--primary-color); color: #fff; }
        .btn-secondary { background-color: var(--surface-color); color: var(--text-color); border: 1px solid var(--primary-color);}
        .btn-green { background-color: var(--accent-green); color: #fff; }
        .btn-red { background-color: var(--accent-red); color: #fff; }
        .tournament-card { display: flex; flex-direction: column; gap: 12px; }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .card-header h3 { font-size: 1.2rem; }
        .status-badge { padding: 4px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: 500; }
        .status-upcoming { background-color: var(--accent-yellow); color: #000; }
        .status-live { background-color: var(--accent-red); color: #fff; }
        .status-ended { background-color: #6c757d; color: #fff; }
        .card-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; }
        .card-details .price-box { background-color: var(--card-details-bg); padding: 8px; border-radius: 8px; text-align: center; }
        .price-box span { display: block; }
        .price-box .label { font-size: 0.75rem; color: var(--text-muted-color); }
        .price-box .value { font-size: 1rem; font-weight: 600; }
        .match-details-btn { cursor: pointer; transition: background-color 0.2s; }
        .match-details-btn:hover { background-color: rgba(0, 169, 255, 0.2); }
        .progress-bar-container { width: 100%; background-color: var(--progress-bg-color); border-radius: 20px; height: 10px; overflow: hidden; }
        .progress-bar { height: 100%; background-color: var(--primary-color); border-radius: 20px; transition: width 0.5s ease-in-out; }
        .progress-info { display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted-color); margin-top: 4px; }
        
        .countdown-timer { background-color: var(--countdown-bg); text-align: center; padding: 8px; border-radius: 6px; font-weight: 600; font-size: 0.95rem; margin-top: 10px; }
        .countdown-live { color: var(--accent-red); }
        .countdown-ended { color: var(--text-muted-color); }

        .card-actions { display: flex; flex-direction: column; gap: 10px; margin-top: 12px; }
        .card-actions .btn { width: 100%; }
        
        .match-card-style { background-color: #00BFFF; border: 2px solid black; border-radius: 20px; padding: 15px; color: black; display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .match-header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 2px solid black; padding-bottom: 5px; }
        .match-title { font-size: 1.5rem; font-weight: bold; }
        .match-type { background-color: black; color: white; padding: 5px; text-align: center; border-radius: 4px; font-size: 0.8rem; min-width: 60px; }
        .match-extra-details { display: flex; justify-content: space-around; background-color: rgba(0,0,0,0.1); padding: 8px; border-radius: 5px; font-size: 0.9rem; }
        .match-extra-details strong { color: #000; }
        .match-progress-info { display: flex; justify-content: space-between; background-color: #333; color: white; padding: 8px 10px; border-radius: 5px; font-size: 1rem; font-weight: bold; }
        .match-room-credentials { display: flex; width: 100%; border: 2px solid black; border-radius: 10px; overflow: hidden; background-color: var(--background-color); color: var(--text-color); }
        .match-room-credentials > div { padding: 10px; font-size: 1.1rem; width: 50%; text-align: center; font-weight: bold; }
        .match-room-id { border-right: 1px solid black; }

        #feed-page ul { list-style: none; }
        #feed-page li { display: flex; align-items: center; background-color: var(--surface-color); padding: 10px 15px; border-radius: 8px; margin-bottom: 8px; }
        .rank { font-size: 1.2rem; font-weight: 700; color: var(--primary-color); min-width: 40px; }
        .player-info { flex-grow: 1; }
        .player-balance { font-weight: 600; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: var(--text-muted-color); }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; background-color: var(--input-bg-color); border: 1px solid var(--input-border-color); border-radius: 8px; color: var(--text-color); font-size: 1rem; }

        /* Wallet Page - New Styles */
        .wallet-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .wallet-actions .btn { width: 100%; padding: 15px; font-size: 1.1rem; }
        .wallet-form { background-color: var(--surface-color); padding: 20px; border-radius: 12px; }
        .payment-tabs { display: flex; border-bottom: 1px solid var(--border-color); margin-bottom: 15px; }
        .payment-tabs button { flex: 1; background: none; border: none; color: var(--text-muted-color); padding: 10px; cursor: pointer; font-size: 1rem; font-weight: 500; border-bottom: 3px solid transparent; }
        .payment-tabs button.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .payment-instructions { background-color: var(--card-details-bg); padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: center; }
        .payment-instructions p { margin: 5px 0; color: var(--text-muted-color); }
        .payment-instructions strong { color: var(--text-color); font-size: 1.2rem; display: inline-block; background-color: rgba(0,0,0,0.2); padding: 5px 10px; border-radius: 5px; user-select: all; }
        .payment-instructions .copy-btn { margin-left: 10px; cursor: pointer; }
        
        .transaction-history-container { margin-top: 25px; background-color: var(--surface-color); padding: 20px; border-radius: 12px;}
        .transaction-history-container h3 { margin-bottom: 15px; }
        .transaction-history-container ul { list-style: none; padding: 0; max-height: 40vh; overflow-y: auto; }
        .transaction-history-container li { display: flex; justify-content: space-between; align-items: center; padding: 12px 10px; background-color: var(--list-item-bg); border-radius: 8px; margin-bottom: 8px; }
        .transaction-info .type { font-weight: 600; font-size: 1.1em; }
        .transaction-info .type.deposit { color: var(--accent-green); }
        .transaction-info .type.withdrawal { color: var(--accent-red); }
        .transaction-info .date { font-size: 0.8em; color: var(--text-muted-color); display: block; margin-top: 2px;}
        .transaction-details { text-align: right; }
        .transaction-details .amount { font-weight: 700; font-size: 1.2em; }
        .transaction-details .status { font-size: 0.8em; font-weight: 500; padding: 3px 8px; border-radius: 10px; display: block; text-transform: capitalize; margin-top: 2px; }
        .status-approved { background-color: var(--accent-green); color: white; }
        .status-pending { background-color: var(--accent-yellow); color: black; }
        .status-rejected { background-color: var(--accent-red); color: white; }
        
        /* Profile Page - New Styles */
        .profile-main-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: white;
            margin-bottom: 25px;
        }
        .profile-main-card .avatar {
            width: 80px; height: 80px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.2);
            margin: 0 auto 10px auto;
            display: flex; justify-content: center; align-items: center;
            font-size: 2.5rem;
        }
        .profile-main-card h2 { font-size: 1.5rem; margin-bottom: 5px; }
        .profile-stats {
            display: flex;
            justify-content: space-around;
            border-top: 1px solid rgba(255,255,255,0.3);
            padding-top: 15px;
            margin-top: 15px;
        }
        .profile-stats div { flex: 1; }
        .profile-stats .stat-value { font-size: 1.2rem; font-weight: 600; }
        .profile-stats .stat-label { font-size: 0.8rem; opacity: 0.8; }
        
        .profile-menu { list-style: none; padding: 0; }
        .profile-menu li a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background-color: var(--surface-color);
            margin-bottom: 10px;
            border-radius: 10px;
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            transition: transform 0.2s, background-color 0.2s;
        }
        .profile-menu li a:hover { background-color: var(--primary-color); color: white; transform: scale(1.02); }
        .profile-menu li a i { font-size: 1.2rem; width: 25px; text-align: center; color: var(--primary-color); }
        .profile-menu li a:hover i { color: white; }
        .profile-menu .logout-btn-container { margin-top: 20px; }
        .profile-menu .logout-btn-container .btn { width: 100%; background-color: var(--surface-color); color: var(--accent-red); }
        .profile-menu .logout-btn-container .btn:hover { background-color: var(--accent-red); color: white; }
        
        .profile-section { background-color: var(--surface-color); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .profile-section h3 { margin-bottom: 15px; }
        .social-links { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
        .social-links a { color: #fff; font-size: 2rem; }

        .theme-switcher { display: flex; gap: 10px; }
        .theme-switcher .btn { flex-grow: 1; }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            padding: 15px;
        }
        .modal-content {
            background-color: var(--surface-color);
            padding: 20px;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .modal-header h3 { color: var(--primary-color); }
        .modal-close-btn { background: none; border: none; font-size: 1.5rem; color: var(--text-color); cursor: pointer; }
        .modal-body { line-height: 1.6; }
        .modal-body p strong { color: var(--primary-color); }

        /* Purchased Product Card */
        .purchased-product-card {
            background-color: var(--surface-color);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 5px solid var(--accent-green);
        }
        .purchased-product-card h3 {
             margin-bottom: 10px;
        }
        .purchased-product-card .btn-download {
            width: 100%;
            margin-top: 10px;
            background-color: var(--accent-green);
            color: white;
            text-decoration: none;
        }
        
        /* === Result Page Styles (New) === */
        .result-card {
            background-color: var(--surface-color);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        .result-header h3 {
            color: var(--primary-color);
            font-size: 1.2rem;
        }
        .result-header .date {
            font-size: 0.8rem;
            color: var(--text-muted-color);
        }
        .winner-list-header {
            display: grid;
            grid-template-columns: 1fr 3fr 1fr 2fr;
            gap: 10px;
            font-weight: 600;
            padding: 8px;
            font-size: 0.8rem;
            color: var(--text-muted-color);
        }
        .winner-item {
            display: grid;
            grid-template-columns: 1fr 3fr 1fr 2fr;
            gap: 10px;
            align-items: center;
            background-color: var(--list-item-bg);
            padding: 10px 8px;
            border-radius: 6px;
            margin-bottom: 5px;
        }
        .winner-item .rank {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary-color);
        }
        .winner-item .player-name {
             font-weight: 500;
        }
        .winner-item .kills, .winner-item .prize {
            text-align: center;
            font-weight: 600;
        }
        .winner-item .prize {
            color: var(--accent-green);
        }

        /* === New Withdraw Section Styles === */
        #withdraw-form-container.wallet-form {
            border: 1px solid var(--border-color);
        }
        .available-amount-box {
            background-color: var(--background-color);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        .available-amount-box span {
            display: block;
            color: var(--text-muted-color);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        .available-amount-box strong {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
        }
        .withdraw-payment-tabs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .withdraw-payment-tab {
            background-color: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: var(--font-family);
            color: var(--text-muted-color);
            transition: all 0.2s ease;
        }
        .withdraw-payment-tab:hover {
            border-color: var(--primary-color);
        }
        .withdraw-payment-tab.active {
            border-color: var(--primary-color);
            background-color: rgba(0, 169, 255, 0.1);
            color: var(--primary-color);
            font-weight: 600;
        }
        .withdraw-payment-tab img {
            height: 24px;
        }
        .withdraw-payment-tab span {
            font-size: 0.9rem;
        }
        .form-group.withdraw-input-group {
            position: relative;
            display: flex;
            align-items: center;
            background-color: var(--input-bg-color);
            border: 1px solid var(--input-border-color);
            border-radius: 8px;
            padding-left: 15px;
        }
        .form-group.withdraw-input-group i,
        .form-group.withdraw-input-group span {
            color: var(--text-muted-color);
            font-size: 1.1rem;
        }
        .form-group.withdraw-input-group input {
            border: none;
            padding-left: 10px;
            flex-grow: 1;
        }
        .min-withdraw-text {
            text-align: center;
            color: var(--accent-red);
            font-size: 0.9rem;
            margin-top: -5px;
            margin-bottom: 15px;
        }
        .btn-orange {
            background: linear-gradient(to right, #ff8c00, #ff6347);
            color: white;
            font-size: 1.1rem !important;
            padding: 12px 20px !important;
            border-radius: 50px !important;
            border: none;
            box-shadow: 0 4px 10px rgba(255, 107, 107, 0.4);
        }

        /* === New Help Section Styles === */
        .help-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        .help-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--background-color);
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .help-text h4 {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-muted-color);
            margin: 0;
            line-height: 1.2;
        }
        .help-text p {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-color);
            margin: 0;
             line-height: 1.4;
        }
        .btn-video {
            background-color: #E91E63;
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        .contact-section {
            text-align: center;
            margin-top: 25px;
        }
        .contact-section p {
            margin-bottom: 12px;
            font-size: 1rem;
        }
        .btn-contact {
            background-color: transparent;
            color: var(--text-color);
            border: 2px solid var(--text-color);
            padding: 10px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s ease;
        }
        .btn-contact:hover {
            background-color: var(--text-color);
            color: var(--surface-color);
        }

    </style>
</head>
<body>

    <div id="auth-container">
        <div class="auth-wrapper">
            <div class="form-box login">
                <h2>Login</h2>
                <form id="login-form">
                    <div id="login-error" class="auth-error hidden"></div>
                    <div class="input-box"> <span class="icon"><i class="fa-solid fa-envelope"></i></span> <input type="email" id="login-email" required> <label>Email</label> </div>
                    <div class="input-box"> <span class="icon"><i class="fa-solid fa-lock"></i></span> <input type="password" id="login-password" required> <label>Password</label> </div>
                    <button type="submit" class="auth-btn">Login</button>
                    <div class="login-register"> <p>Don't have an account? <a href="#" class="register-link">Register</a></p> </div>
                </form>
            </div>
            <div class="form-box register">
                <h2>Registration</h2>
                <form id="register-form">
                    <div id="register-error" class="auth-error hidden"></div>
                    <div class="input-box"> <span class="icon"><i class="fa-solid fa-user"></i></span> <input type="text" id="register-username" required> <label>Username</label> </div>
                    <div class="input-box"> <span class="icon"><i class="fa-solid fa-envelope"></i></span> <input type="email" id="register-email" required> <label>Email</label> </div>
                    <div class="input-box"> <span class="icon"><i class="fa-solid fa-lock"></i></span> <input type="password" id="register-password" required> <label>Password</label> </div>
                    <button type="submit" class="auth-btn">Register</button>
                    <div class="login-register"> <p>Already have an account? <a href="#" class="login-link">Login</a></p> </div>
                </form>
            </div>
        </div>
    </div>

    <div id="app-container" class="hidden">
        <header>
            <div class="logo"> <img src="https://iili.io/KcwwqrX.md.jpg" alt="Dragon ESP Logo"> Drazon ESP </div>
            <div class="wallet-balance" id="main-wallet-balance">৳ 0</div>
        </header>

        <main id="main-content">
            <section id="home-page">
                 <!-- Slider container -->
                <div id="slider-container" class="slider">
                    <div id="slider-images" class="slider-images">
                        <!-- Slides will be inserted here by JavaScript -->
                    </div>
                    <div id="slider-dots" class="slider-dots">
                        <!-- Dots will be inserted here by JavaScript -->
                    </div>
                </div>
                <!-- Tournaments container -->
                <div id="home-tournaments-container"></div>
            </section>
            <section id="joined-page" class="hidden"></section>
            <section id="result-page" class="hidden">
                 <h2>🏆 Tournament Results</h2><br>
                 <div id="tournament-results-container"></div>
            </section>
            <section id="feed-page" class="hidden">
                <h2>🏆 Top Players</h2> <br>
                <ul id="leaderboard-list"></ul>
            </section>

            <section id="wallet-page" class="hidden">
                <div class="wallet-actions">
                    <button id="show-add-money-btn" class="btn btn-primary">Add Money</button>
                    <button id="show-withdraw-btn" class="btn btn-secondary">Withdraw</button>
                </div>

                 <div id="add-money-form-container" class="wallet-form">
                    <h3>Add Money</h3>
                     <div class="payment-tabs">
                        <button class="payment-tab active" data-target="bkash">
                            <img src="https://iili.io/K8FRvPn.png" alt="bKash" height="20">
                        </button>
                        <button class="payment-tab" data-target="rocket">
                             <img src="https://iili.io/K8FArhP.png" alt="Rocket" height="20">
                        </button>
                        <button class="payment-tab" data-target="nagad">
                             <img src="https://iili.io/K8FRkMX.png" alt="Nagad" height="20">
                        </button>
                    </div>

                    <div id="bkash" class="payment-content">
                         <div class="payment-instructions">
                             <p>নিচের বিকাশ নম্বরে টাকা Send Money করুন</p>
                             <p>
                                 <strong id="bkash-number">015438635</strong>
                                 <i class="fas fa-copy copy-btn" data-copy-target="bkash-number"></i>
                             </p>
                         </div>
                    </div>
                     <div id="rocket" class="payment-content hidden">
                         <div class="payment-instructions">
                             <p>নিচের রকেট নম্বরে টাকা Send Money করুন</p>
                             <p>
                                 <strong id="rocket-number">015438635</strong>
                                  <i class="fas fa-copy copy-btn" data-copy-target="rocket-number"></i>
                             </p>
                         </div>
                    </div>
                     <div id="nagad" class="payment-content hidden">
                         <div class="payment-instructions">
                             <p>নিচের নগদ নম্বরে টাকা Send Money করুন</p>
                              <p>
                                 <strong id="nagad-number">015438635</strong>
                                 <i class="fas fa-copy copy-btn" data-copy-target="nagad-number"></i>
                             </p>
                         </div>
                    </div>
                     
                    <form id="deposit-form">
                        <div class="form-group">
                            <label for="deposit-amount">Amount (টাকা)</label>
                            <input type="number" id="deposit-amount" placeholder="e.g., 500" required>
                        </div>
                        <div class="form-group">
                            <label for="deposit-code">Transaction ID দিন</label>
                            <input type="text" id="deposit-code" placeholder="e.g., TRx123ABC" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width:100%;">VERIFY</button>
                    </form>
                    
                    <!-- Updated Help Section -->
                    <div class="help-section">
                        <div class="help-item">
                            <div class="help-text">
                                <h4>HOW TO ADD MONEY?</h4>
                                <p>কিভাবে টাকা এড করবেন?</p>
                            </div>
                            <a id="add-money-video-link" href="#" target="_blank" class="btn-video"><i class="fas fa-play"></i> ভিডিও দেখুন</a>
                        </div>
                        <div class="help-item">
                            <div class="help-text">
                                <h4>HOW TO GET ROOM ID?</h4>
                                <p>কিভাবে রুম আইডি পাবেন?</p>
                            </div>
                            <a id="get-room-id-video-link" href="#" target="_blank" class="btn-video"><i class="fas fa-play"></i> ভিডিও দেখুন</a>
                        </div>
                        <div class="help-item">
                            <div class="help-text">
                                <h4>HOW TO JOIN MATCH?</h4>
                                <p>কিভাবে ম্যাচ জয়েন করবেন?</p>
                            </div>
                            <a id="join-match-video-link" href="#" target="_blank" class="btn-video"><i class="fas fa-play"></i> ভিডিও দেখুন</a>
                        </div>
                        <div class="contact-section">
                            <p>টাকা এড না হলে এখানে মেসেজ দিন</p>
                            <a id="contact-us-link" href="#" target="_blank" class="btn-contact"><i class="fas fa-comment-alt"></i> CONTACT US</a>
                        </div>
                    </div>
                    <!-- End of Section -->
                </div>
                
                 <div id="withdraw-form-container" class="wallet-form hidden">
                    <div class="available-amount-box">
                        <span>Available Amount</span>
                        <strong id="withdraw-available-balance">💰 ৳0</strong>
                    </div>

                    <div class="withdraw-payment-tabs">
                        <button class="withdraw-payment-tab active" data-method="bKash">
                            <img src="https://iili.io/K8FRvPn.png" alt="bKash">
                            <span>bKash</span>
                        </button>
                        <button class="withdraw-payment-tab" data-method="Nagad">
                            <img src="https://iili.io/K8FRkMX.png" alt="Nagad">
                             <span>Nagad</span>
                        </button>
                        <button class="withdraw-payment-tab" data-method="Rocket">
                            <img src="https://iili.io/K8FArhP.png" alt="Rocket">
                            <span>Rocket</span>
                        </button>
                    </div>

                    <form id="withdraw-form">
                        <div class="form-group withdraw-input-group">
                            <i class="fas fa-mobile-alt"></i>
                            <input type="tel" id="withdraw-number" placeholder="Mobile Number" required>
                        </div>
                        <div class="form-group withdraw-input-group">
                            <span>৳</span>
                            <input type="number" id="withdraw-amount" placeholder="Amount to Withdraw" required>
                        </div>
                        <p class="min-withdraw-text">Minimum Withdrawal amount is ৳100</p>
                        <button type="submit" class="btn btn-orange" style="width:100%;">Withdraw</button>
                    </form>
                </div>

                <div class="transaction-history-container">
                    <h3>Transaction History</h3>
                    <ul id="transaction-list"></ul>
                </div>
            </section>

            <section id="profile-page" class="hidden">
                <div class="profile-main-card">
                    <div class="avatar"><i class="fa-solid fa-user"></i></div>
                    <h2 id="profile-username">Username</h2>
                    <p style="margin-top:-10px; margin-bottom: 15px; opacity: 0.9;">
                        UID: <strong id="profile-uid-display">Not set</strong> 
                        <i id="toggle-edit-profile" class="fas fa-edit" style="cursor:pointer; margin-left: 8px;" title="Edit UID"></i>
                    </p>
                    <div class="profile-stats">
                        <div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">Match Played</div>
                        </div>
                        <div>
                            <div class="stat-value" id="profile-balance-display">BDT 0</div>
                            <div class="stat-label">Balance</div>
                        </div>
                        <div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">Won</div>
                        </div>
                    </div>
                </div>

                <ul class="profile-menu">
                    <li><a href="#wallet" class="nav-link-profile"><i class="fas fa-wallet"></i> Wallet</a></li>
                    <li><a href="#wallet" id="withdraw-shortcut-btn"><i class="fas fa-hand-holding-usd"></i> Withdraw</a></li>
                    <li><a href="#" id="refer-btn"><i class="fas fa-share-alt"></i> Refer And Earn</a></li>
                    <li><a href="#" id="my-profile-btn"><i class="fas fa-user-edit"></i> Edit Profile</a></li>
                    <li><a href="#feed" class="nav-link-profile"><i class="fas fa-trophy"></i> Top Players</a></li>
                    <li><a href="#" id="support-btn"><i class="fas fa-headset"></i> Support Profile</a></li>
                    <li class="logout-btn-container"><button class="btn" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button></li>
                </ul>
                
                <div id="edit-profile-section" class="profile-section hidden">
                    <h3>Edit Profile</h3>
                    <form id="edit-profile-form" style="margin-top: 15px;">
                        <div class="form-group"> <label for="edit-uid">Update your Free Fire UID</label> <input type="text" id="edit-uid" placeholder="Enter your UID"> </div>
                        <button type="submit" class="btn btn-primary">Save UID</button>
                    </form>
                </div>
                
                <div id="support-section" class="profile-section hidden">
                    <h3>About Us</h3>
                    <p id="about-us-content">Loading...</p>
                    <div class="social-links">
                        <a id="facebook-link" href="#" target="_blank"><i class="fab fa-facebook"></i></a>
                        <a id="youtube-link" href="#" target="_blank"><i class="fab fa-youtube"></i></a>
                        <a id="messenger-link" href="#" target="_blank"><i class="fab fa-facebook-messenger"></i></a>
                    </div>
                </div>

            </section>
        </main>

        <nav id="bottom-nav">
            <a href="#home" class="nav-link active"> <i class="fas fa-home"></i> <span>Home</span> </a>
            <a href="#joined" class="nav-link"> <i class="fas fa-gamepad"></i> <span>Joined</span> </a>
            <a href="#result" class="nav-link"> <i class="fas fa-trophy"></i> <span>Result</span> </a>
            <a href="#wallet" class="nav-link"> <i class="fas fa-wallet"></i> <span>Wallet</span> </a>
            <a href="#profile" class="nav-link"> <i class="fas fa-user"></i> <span>You</span> </a>
        </nav>
    </div>

    <div id="details-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Match Details</h3>
                <button id="modal-close-btn" class="modal-close-btn">&times;</button>
            </div>
            <div id="modal-body" class="modal-body"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getDatabase, ref, set, onValue, query, orderByChild, runTransaction, push, serverTimestamp, equalTo, get } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
        
        const firebaseConfig = {
          apiKey: "AIzaSyAx2gaVe5RndZGqHSLoiBHHazQSmGxX-iw",
          authDomain: "flame-tournament.firebaseapp.com",
          databaseURL: "https://flame-tournament-default-rtdb.firebaseio.com",
          projectId: "flame-tournament",
          storageBucket: "flame-tournament.firebasestorage.app",
          messagingSenderId: "202172477912",
          appId: "1:202172477912:web:4f6333609d1543001582ad",
          measurementId: "G-SLVEMN4C1N"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const mainContent = document.getElementById('main-content');
        const authWrapper = document.querySelector('.auth-wrapper');
        const loginLink = document.querySelector('.login-link');
        const registerLink = document.querySelector('.register-link');
        
        let currentUser = null;
        let currentUserData = null;
        let sliderInterval; // For automatic sliding
        
        loginLink.addEventListener('click', () => authWrapper.classList.remove('active'));
        registerLink.addEventListener('click', () => authWrapper.classList.add('active'));
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginErrorEl = document.getElementById('login-error');
        const registerErrorEl = document.getElementById('register-error');

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            signInWithEmailAndPassword(auth, loginForm['login-email'].value, loginForm['login-password'].value)
                .catch(error => { loginErrorEl.textContent = error.message; loginErrorEl.classList.remove('hidden'); });
        });
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = registerForm['register-username'].value;
            const email = registerForm['register-email'].value;
            const password = registerForm['register-password'].value;
            createUserWithEmailAndPassword(auth, email, password)
                .then(userCredential => set(ref(db, 'users/' + userCredential.user.uid), { username: username, email: email, balance: 0, freeFireUid: '' }))
                .catch(error => { registerErrorEl.textContent = error.message; registerErrorEl.classList.remove('hidden'); });
        });
        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));

        // --- UPDATED AUTHENTICATION LOGIC ---
        onAuthStateChanged(auth, user => {
            if (user) {
                currentUser = user;
                authContainer.classList.add('hidden'); 
                appContainer.classList.remove('hidden');
                listenToUserData(user.uid);
                loadAppInfo(); // Load global app info once after login
                router();
            } else {
                currentUser = null; 
                currentUserData = null;
                authContainer.classList.remove('hidden'); 
                appContainer.classList.add('hidden');
            }
        });
        
        function listenToUserData(uid) {
            onValue(ref(db, 'users/' + uid), (snapshot) => { if (snapshot.exists()) { currentUserData = { uid, ...snapshot.val()}; updateUIWithUserData(); }});
        }

        function updateUIWithUserData() {
            if (!currentUserData) return;
            const balance = currentUserData.balance || 0;
            document.getElementById('main-wallet-balance').textContent = `৳ ${balance}`;
            document.getElementById('profile-username').textContent = currentUserData.username;
            document.getElementById('profile-balance-display').textContent = `BDT ${balance}`;
            document.getElementById('profile-uid-display').textContent = currentUserData.freeFireUid || 'Not set';
            document.getElementById('edit-uid').value = currentUserData.freeFireUid || '';
            document.getElementById('withdraw-available-balance').innerHTML = `💰 ৳${balance}`;
        }

        const pages = mainContent.querySelectorAll('section');
        const navLinks = document.querySelectorAll('.nav-link');
        function router() {
            const hash = window.location.hash || '#home';
            pages.forEach(page => page.classList.add('hidden'));
            navLinks.forEach(link => link.classList.remove('active'));
            
            const editProfileSection = document.getElementById('edit-profile-section');
            const supportSection = document.getElementById('support-section');
            if(editProfileSection) editProfileSection.classList.add('hidden');
            if(supportSection) supportSection.classList.add('hidden');

            const targetPage = document.querySelector(hash + '-page');
            const targetLink = document.querySelector(`a[href="${hash}"]`);
            if (targetPage) {
                targetPage.classList.remove('hidden');
                if (targetLink) targetLink.classList.add('active');
                loadPageData(hash.substring(1));
            } else {
                document.getElementById('home-page').classList.remove('hidden');
                document.querySelector('a[href="#home"]').classList.add('active');
                loadPageData('home');
            }
        }
        
        // --- UPDATED PAGE DATA LOADER ---
        function loadPageData(pageName) {
            clearInterval(sliderInterval); // Stop slider when changing page
            switch(pageName) {
                case 'home': loadSliderAndTournaments(); break;
                case 'joined': loadJoinedItems(); break;
                case 'result': loadTournamentResults(); break;
                case 'feed': loadLeaderboard(); break;
                case 'wallet': loadTransactionHistory(); setupWalletPage(); break;
                case 'profile': setupProfilePage(); break; // loadAppInfo is no longer needed here
            }
        }

        window.addEventListener('hashchange', router);
        window.addEventListener('load', () => { if (!window.location.hash) { window.location.hash = '#home'; } router(); });
        
        document.querySelectorAll('.nav-link, .nav-link-profile').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetHash = new URL(link.href).hash;
                if(window.location.hash !== targetHash){ window.location.hash = targetHash; }
            });
        });
        
        function loadSliderAndTournaments() {
            const sliderImagesContainer = document.getElementById('slider-images');
            const sliderDotsContainer = document.getElementById('slider-dots');

            onValue(ref(db, 'sliders'), (snapshot) => {
                if (snapshot.exists()) {
                    const sliderData = snapshot.val();
                    let slidesHtml = '';
                    let dotsHtml = '';
                    sliderData.forEach((sliderItem, index) => {
                        // Ensure sliderItem is a valid object with an imageUrl
                        if (typeof sliderItem === 'object' && sliderItem.imageUrl) {
                            const link = sliderItem.linkUrl || '#'; // Default to '#' if no link is provided
                            const target = (link.startsWith('http') && !link.includes(window.location.hostname)) ? '_blank' : '_self'; // Open external links in a new tab

                            slidesHtml += `
                                <div class="slide">
                                    <a href="${link}" target="${target}">
                                        <img src="${sliderItem.imageUrl}" alt="Slider Image ${index + 1}">
                                    </a>
                                </div>`;
                            dotsHtml += `<span class="dot" data-slide-index="${index}"></span>`;
                        }
                    });
                    sliderImagesContainer.innerHTML = slidesHtml;
                    sliderDotsContainer.innerHTML = dotsHtml;
                    setupSlider(sliderData.length);
                } else {
                    document.getElementById('slider-container').classList.add('hidden');
                }
            }, { onlyOnce: true });
            
            // Now load tournaments into their dedicated container
            loadTournaments('home-tournaments-container');
        }

        function setupSlider(slideCount) {
            if (slideCount === 0) return;

            let currentSlide = 0;
            const slides = document.querySelectorAll('.slider-images .slide');
            const dots = document.querySelectorAll('.slider-dots .dot');

            function showSlide(index) {
                slides.forEach((slide, i) => {
                    slide.classList.toggle('active', i === index);
                });
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });
            }

            function nextSlide() {
                currentSlide = (currentSlide + 1) % slideCount;
                showSlide(currentSlide);
            }

            dots.forEach(dot => {
                dot.addEventListener('click', (e) => {
                    currentSlide = parseInt(e.target.dataset.slideIndex, 10);
                    showSlide(currentSlide);
                    // Reset interval on manual navigation
                    clearInterval(sliderInterval);
                    sliderInterval = setInterval(nextSlide, 5000);
                });
            });

            showSlide(0); // Show the first slide initially
            clearInterval(sliderInterval); // Clear any previous interval
            sliderInterval = setInterval(nextSlide, 5000); // Start the automatic sliding
        }

        function loadTournaments(containerId) {
            const container = document.getElementById(containerId);
            onValue(ref(db, 'tournaments'), (snapshot) => {
                container.innerHTML = '<h2>Loading Tournaments...</h2>';
                if (!snapshot.exists()) { container.innerHTML = '<h2>No tournaments available.</h2>'; return; }
                const tournaments = snapshot.val();
                let html = '';
                for (const id in tournaments) {
                    const t = tournaments[id];
                    const participants = t.participants ? Object.keys(t.participants) : [];
                    const isJoined = currentUser && participants.includes(currentUser.uid);
                    
                    let matchDetailsHtml = t.matchDetails ? `<div class="price-box match-details-btn" data-tournament-id="${id}"><span class="label">Match</span><span class="value">Details <i class="fas fa-info-circle"></i></span></div>` : '';
                    
                    const joinedCount = participants.length;
                    const progress = (joinedCount / t.maxPlayers) * 100;
                    const isFull = joinedCount >= t.maxPlayers;
                    html += `<div class="card tournament-card" data-id="${id}"><div class="card-header"><h3>${t.name}</h3><span class="status-badge status-${t.status.toLowerCase()}">${t.status}</span></div><p>${new Date(t.dateTime).toLocaleString()}</p><div class="card-details"><div class="price-box"><span class="label">Entry</span><span class="value">৳ ${t.entryFee}</span></div><div class="price-box"><span class="label">Per Kill</span><span class="value">৳ ${t.perKillPrize || 0}</span></div><div class="price-box"><span class="label">Win Prize</span><span class="value">৳ ${t.winPrize}</span></div><div class="price-box"><span class="label">Type</span><span class="value">${t.entryType || 'N/A'}</span></div><div class="price-box"><span class="label">Map</span><span class="value">${t.map || 'N/A'}</span></div>${matchDetailsHtml}</div><div><div class="progress-bar-container"><div class="progress-bar" style="width: ${progress}%;"></div></div><div class="progress-info"><span>Joined: ${joinedCount}</span><span>Total: ${t.maxPlayers}</span></div></div><div class="card-actions">${ isJoined ? `<button class="btn" disabled>✔ Joined</button>` : `<button class="btn btn-primary join-btn" data-fee="${t.entryFee}" data-id="${id}" data-type="${t.entryType || 'Solo'}" ${isFull ? 'disabled' : ''}>${isFull ? 'Full' : 'Join'}</button>`} ${t.liveStreamLink ? `<a href="${t.liveStreamLink}" target="_blank" class="btn btn-red"><i class="fab fa-youtube"></i> Live</a>` : ''}</div></div>`;
                }
                container.innerHTML = html || `<h2>No tournaments available right now.</h2>`;
            });
        }

        function loadTournamentResults() {
            const container = document.getElementById('tournament-results-container');
            onValue(ref(db, 'tournamentResults'), (snapshot) => {
                container.innerHTML = '<h2>Loading Results...</h2>';
                if (!snapshot.exists()) {
                    container.innerHTML = '<h2>No tournament results available yet.</h2>';
                    return;
                }
                const results = snapshot.val();
                let html = '';
                for (const id in results) {
                    const result = results[id];
                    let winnersHtml = '';
                    if(result.winners && result.winners.length > 0) {
                        result.winners.forEach(winner => {
                            winnersHtml += `
                                <div class="winner-item">
                                    <div class="rank">#${winner.rank}</div>
                                    <div class="player-name">${winner.playerName}</div>
                                    <div class="kills">${winner.kills}</div>
                                    <div class="prize">${winner.prize}</div>
                                </div>
                            `;
                        });
                    }

                    html += `
                        <div class="result-card">
                            <div class="result-header">
                                <h3>${result.tournamentName}</h3>
                                <span class="date">${new Date(result.matchDate).toLocaleDateString()}</span>
                            </div>
                            <div class="winner-list">
                                <div class="winner-list-header">
                                    <span>Rank</span>
                                    <span>Name</span>
                                    <span style="text-align:center;">Kills</span>
                                    <span style="text-align:center;">Prize</span>
                                </div>
                                ${winnersHtml}
                            </div>
                        </div>
                    `;
                }
                container.innerHTML = html;
            });
        }

        async function loadJoinedItems() {
            const container = document.getElementById('joined-page');
            container.innerHTML = '<h2>Loading your items...</h2>';
            let html = '';
            let itemsFound = false;

            const tournamentsSnapshot = await get(ref(db, 'tournaments'));
            if (tournamentsSnapshot.exists()) {
                const tournaments = tournamentsSnapshot.val();
                for (const id in tournaments) {
                    const t = tournaments[id];
                    if (t.participants && t.participants[currentUser.uid]) {
                        itemsFound = true;
                        const participants = Object.keys(t.participants);
                        html += `<div class="match-card-style"><div class="match-header"><span class="match-title">${t.name}</span><div class="match-type"><span>${t.entryType ? t.entryType.toUpperCase() : 'N/A'}</span><span>MATCH</span></div></div><div class="match-extra-details"><span><i class="fas fa-map-marker-alt"></i> Map: <strong>${t.map || 'TBA'}</strong></span><span><i class="fas fa-trophy"></i> Win Prize: <strong>৳${t.winPrize || 0}</strong></span></div><div class="match-progress-info"><span>Joined: ${participants.length}</span><span>Total: ${t.maxPlayers}</span></div><div class="match-room-credentials"><div class="match-room-id">Room ID: ${t.roomId && t.showRoomDetails ? t.roomId : 'TBA'}</div><div class="match-room-password">Password: ${t.roomPassword && t.showRoomDetails ? t.roomPassword : 'TBA'}</div></div></div>`;
                    }
                }
            }
            
            if (currentUserData?.purchasedProducts) {
                itemsFound = true;
                for (const productId in currentUserData.purchasedProducts) {
                    const product = currentUserData.purchasedProducts[productId];
                    html += `
                        <div class="purchased-product-card">
                            <h3>${product.name}</h3>
                            <a href="${product.link}" target="_blank" class="btn btn-download">Download</a>
                        </div>
                    `;
                }
            }
            container.innerHTML = itemsFound ? html : '<h2>You have not joined any tournaments or purchased any products.</h2>';
        }

        function loadLeaderboard() {
            const leaderboardList = document.getElementById('leaderboard-list');
            onValue(query(ref(db, 'users'), orderByChild('balance')), (snapshot) => {
                leaderboardList.innerHTML = '<li>Loading...</li>';
                if (!snapshot.exists()) { leaderboardList.innerHTML = '<li>No users found.</li>'; return; }
                const users = []; snapshot.forEach(child => { users.push(child.val()); });
                users.reverse();
                let html = '';
                users.slice(0, 50).forEach((user, index) => { html += `<li><span class="rank">#${index + 1}</span><div class="player-info">${user.username}</div><div class="player-balance">৳ ${user.balance || 0}</div></li>`; });
                leaderboardList.innerHTML = html;
            });
        }
        
        function loadAppInfo() {
            onValue(ref(db, 'appInfo'), (snapshot) => {
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    
                    // Profile Page Links
                    document.getElementById('about-us-content').textContent = data.aboutText || 'About info not set.';
                    document.getElementById('facebook-link').href = data.facebookLink || '#';
                    document.getElementById('youtube-link').href = data.youtubeLink || '#';
                    document.getElementById('messenger-link').href = data.messengerLink || '#';

                    // Wallet Page Links
                    const addMoneyVideoLink = document.getElementById('add-money-video-link');
                    const getRoomIdVideoLink = document.getElementById('get-room-id-video-link');
                    const joinMatchVideoLink = document.getElementById('join-match-video-link');
                    const contactUsLink = document.getElementById('contact-us-link');

                    if (data.helpVideos) {
                        if (addMoneyVideoLink) addMoneyVideoLink.href = data.helpVideos.addMoney || '#';
                        if (getRoomIdVideoLink) getRoomIdVideoLink.href = data.helpVideos.getRoomId || '#';
                        if (joinMatchVideoLink) joinMatchVideoLink.href = data.helpVideos.joinMatch || '#';
                    }
                    
                    if(contactUsLink) contactUsLink.href = data.contactLink || '#';
                }
            });
        }
        
        async function loadTransactionHistory() {
            const listContainer = document.getElementById('transaction-list');
            if (!currentUser) return;
            listContainer.innerHTML = '<li>Loading history...</li>';
            try {
                const [depositSnapshot, withdrawalSnapshot] = await Promise.all([get(query(ref(db, 'depositRequests'), orderByChild('userId'), equalTo(currentUser.uid))), get(query(ref(db, 'withdrawalRequests'), orderByChild('userId'), equalTo(currentUser.uid)))]);
                let transactions = [];
                if (depositSnapshot.exists()) { depositSnapshot.forEach(child => { transactions.push({ type: 'Deposit', ...child.val() }); }); }
                if (withdrawalSnapshot.exists()) { withdrawalSnapshot.forEach(child => { transactions.push({ type: 'Withdrawal', ...child.val() }); }); }
                if (transactions.length === 0) { listContainer.innerHTML = '<li>No transactions found.</li>'; return; }
                transactions.sort((a, b) => b.timestamp - a.timestamp);
                let html = '';
                transactions.forEach(tx => { html += `<li><div class="transaction-info"><span class="type ${tx.type.toLowerCase()}">${tx.type}</span><span class="date">${new Date(tx.timestamp).toLocaleString()}</span></div><div class="transaction-details"><span class="amount">৳ ${tx.amount}</span><span class="status status-${tx.status}">${tx.status}</span></div></li>`; });
                listContainer.innerHTML = html;
            } catch (error) { console.error("Error loading transaction history:", error); listContainer.innerHTML = '<li>Could not load history.</li>'; }
        }

        mainContent.addEventListener('click', (e) => {
            const joinBtn = e.target.closest('.join-btn');
            const detailsBtn = e.target.closest('.match-details-btn');
            const copyBtn = e.target.closest('.copy-btn');

            if (joinBtn) {
                const tournamentId = joinBtn.dataset.id; 
                const entryFee = parseInt(joinBtn.dataset.fee, 10);
                const entryType = joinBtn.dataset.type;
                if (!currentUserData.freeFireUid) { alert('Please set your Free Fire UID in your profile first!'); window.location.hash = '#profile'; return; }
                if (!currentUserData || currentUserData.balance < entryFee) { alert(`Insufficient balance to join!\n\nRequired: ৳${entryFee}\nYour Balance: ৳${currentUserData?.balance || 0}`); return; }
                let teamUIDs = { player1_uid: currentUserData.freeFireUid }, proceed = true;
                if (entryType === 'Duo') { const p2 = prompt("Enter 2nd Player's UID:"); if(p2) teamUIDs.p2 = p2; else proceed = false; }
                if (entryType === 'Squad') { const p2 = prompt("Enter 2nd Player's UID:"), p3 = prompt("Enter 3rd Player's UID:"), p4 = prompt("Enter 4th Player's UID:"); if(p2&&p3&&p4){ teamUIDs.p2=p2; teamUIDs.p3=p3; teamUIDs.p4=p4; } else proceed = false; }
                if (proceed && confirm(`Join this tournament for ৳${entryFee}?`)) joinTournament(tournamentId, entryFee, teamUIDs);
            }
            if (detailsBtn) showMatchDetailsModal(detailsBtn.dataset.tournamentId);
            if (copyBtn) {
                const targetId = copyBtn.dataset.copyTarget;
                const textToCopy = document.getElementById(targetId).textContent;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    alert('Number copied!');
                });
            }
        });

        async function joinTournament(tournamentId, fee, teamUIDs) {
            try {
                const result = await runTransaction(ref(db, `users/${currentUser.uid}/balance`), (bal) => (bal < fee) ? undefined : bal - fee);
                if (result.committed) { 
                    await set(ref(db, `tournaments/${tournamentId}/participants/${currentUser.uid}`), teamUIDs); 
                    alert('Successfully joined the tournament!'); 
                } else { 
                    alert('Failed to join. Not enough money or a database error occurred.'); 
                }
            } catch (error) { console.error("Join failed: ", error); alert('Failed to join due to an error.'); }
        }
        
        const detailsModal = document.getElementById('details-modal');

        async function showMatchDetailsModal(tournamentId) {
            detailsModal.classList.remove('hidden');
            const modalBody = document.getElementById('modal-body');
            modalBody.innerHTML = '<p>Loading...</p>';
            const snapshot = await get(ref(db, `tournaments/${tournamentId}/matchDetails`));
            if (snapshot.exists()) modalBody.innerHTML = Object.values(snapshot.val()).map((v, i) => `<p><strong>Match ${i+1}:</strong> ${v}</p>`).join('');
            else modalBody.innerHTML = '<p>No match details found.</p>';
        }
        function hideDetailsModal() { detailsModal.classList.add('hidden'); }
        detailsModal.querySelector('.modal-close-btn').addEventListener('click', hideDetailsModal);
        
        document.getElementById('edit-profile-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const newUid = document.getElementById('edit-uid').value.trim();
            if (newUid) { set(ref(db, `users/${currentUser.uid}/freeFireUid`), newUid).then(() => alert('UID updated!')).catch(err => alert('Error: ' + err.message)); }
        });
        
        function setupWalletPage() {
            const addMoneyBtn = document.getElementById('show-add-money-btn');
            const withdrawBtn = document.getElementById('show-withdraw-btn');
            const addMoneyForm = document.getElementById('add-money-form-container');
            const withdrawForm = document.getElementById('withdraw-form-container');

            addMoneyBtn.addEventListener('click', () => {
                addMoneyForm.classList.remove('hidden');
                withdrawForm.classList.add('hidden');
                addMoneyBtn.classList.replace('btn-secondary', 'btn-primary');
                withdrawBtn.classList.replace('btn-primary', 'btn-secondary');
            });

            withdrawBtn.addEventListener('click', () => {
                withdrawForm.classList.remove('hidden');
                addMoneyForm.classList.add('hidden');
                withdrawBtn.classList.replace('btn-secondary', 'btn-primary');
                addMoneyBtn.classList.replace('btn-primary', 'btn-secondary');
            });

            // Add money tabs
            const paymentTabs = document.querySelectorAll('.payment-tab');
            const paymentContents = document.querySelectorAll('.payment-content');
            paymentTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    paymentTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    paymentContents.forEach(content => content.classList.add('hidden'));
                    document.getElementById(tab.dataset.target).classList.remove('hidden');
                });
            });

            // Withdraw money tabs
            const withdrawPaymentTabs = document.querySelectorAll('.withdraw-payment-tab');
            withdrawPaymentTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    withdrawPaymentTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                });
            });
        }
        
        function setupProfilePage() {
            const editSection = document.getElementById('edit-profile-section');
            const supportSection = document.getElementById('support-section');

            const toggleEditSection = (e) => {
                e.preventDefault();
                supportSection.classList.add('hidden');
                editSection.classList.toggle('hidden');
                if (!editSection.classList.contains('hidden')) {
                     editSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            };

            document.getElementById('my-profile-btn').addEventListener('click', toggleEditSection);
            document.getElementById('toggle-edit-profile').addEventListener('click', toggleEditSection);

            document.getElementById('support-btn').addEventListener('click', (e) => {
                e.preventDefault();
                editSection.classList.add('hidden');
                supportSection.classList.toggle('hidden');
                if (!supportSection.classList.contains('hidden')) {
                     supportSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });

            document.getElementById('withdraw-shortcut-btn').addEventListener('click', (e) => {
                 e.preventDefault();
                 window.location.hash = '#wallet';
                 setTimeout(() => {
                    const withdrawBtn = document.getElementById('show-withdraw-btn');
                    if (withdrawBtn) withdrawBtn.click();
                 }, 100);
            });
            document.getElementById('refer-btn').addEventListener('click', e => {
                e.preventDefault();
                alert('Referral system is coming soon!');
            });
        }
        
        document.getElementById('deposit-form').addEventListener('submit', async (e) => {
            e.preventDefault(); const btn = e.target.querySelector('button'); btn.disabled = true;
            try {
                await push(ref(db, 'depositRequests'), { userId: currentUser.uid, username: currentUserData.username, amount: Number(document.getElementById('deposit-amount').value), code: document.getElementById('deposit-code').value.trim(), status: 'pending', timestamp: serverTimestamp() });
                alert('Deposit request submitted!'); e.target.reset();
            } catch (error) { alert('An error occurred.'); } finally { btn.disabled = false; }
        });
        
        document.getElementById('withdraw-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const amount = Number(document.getElementById('withdraw-amount').value);
            const number = document.getElementById('withdraw-number').value.trim();
            const activeTab = document.querySelector('.withdraw-payment-tab.active');

            if (!activeTab) {
                alert("Please select a payment method.");
                return;
            }
            const method = activeTab.dataset.method;

            if (amount < 100) {
                alert("Minimum withdrawal amount is ৳100.");
                return;
            }
            if (amount <= 0) {
                alert("Please enter a valid amount.");
                return;
            }
            if (!number) {
                alert("Please provide your mobile number.");
                return;
            }
            if (currentUserData && amount > currentUserData.balance) { 
                alert("You cannot withdraw more than your current balance."); 
                return; 
            }

            const btn = e.target.querySelector('button'); 
            btn.disabled = true;
            try {
                await push(ref(db, 'withdrawalRequests'), { 
                    userId: currentUser.uid, 
                    username: currentUserData.username, 
                    amount: amount, 
                    paymentDetails: `${method} - ${number}`, 
                    status: 'pending', 
                    timestamp: serverTimestamp() 
                });
                alert('Withdrawal request submitted successfully!'); 
                e.target.reset();
            } catch (error) { 
                alert('An error occurred while submitting your request.'); 
                console.error("Withdrawal Error: ", error);
            } finally { 
                btn.disabled = false; 
            }
        });
    </script>
</body>
</html>